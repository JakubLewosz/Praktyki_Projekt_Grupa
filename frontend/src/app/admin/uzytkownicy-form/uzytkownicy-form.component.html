<div class="form-container">
  <!-- Tytuł zmienia się w zależności od trybu -->
  <h2>{{ userDoEdycji ? 'Edytuj Użytkownika' : 'Dodaj Nowego Użytkownika' }}</h2>
  
  <form [formGroup]="form" (ngSubmit)="zapisz()">
    
    <div class="form-group">
      <label>Nazwa Użytkownika (Username) *</label>
      <input type="text" formControlName="username">
    </div>

    <div class="form-group">
      <label>Email *</label>
      <input type="email" formControlName="email">
    </div>

    <div class="form-group">
      <label>Rola *</label>
      <select formControlName="rola">
        <!-- Pamiętaj, że w .ts mapujemy te teksty na liczby (0, 1, 2) -->
        <option>Admin</option>
        <option>Pracownik UKNF</option>
        <option>Podmiot</option>
      </select>
    </div>

    <div class="form-group">
      <label>Hasło {{ userDoEdycji ? '(pozostaw puste, by nie zmieniać)' : '*' }}</label>
      <input type="password" formControlName="password" autocomplete="new-password">
    </div>

    <!-- (W przyszłości tu będzie wybór podmiotu, jeśli rola to "Podmiot") -->

    <div class="form-actions">
      <button type="button" (click)="anuluj()" class="btn-cancel">Anuluj</button>
      <button type="submit" class="btn-save" [disabled]="form.invalid">Zapisz</button>
    </div>

    @if (form.get('rola')?.value === 'Podmiot') {
      <div class="form-group" style="background-color: #f5f5f5; padding: 10px; border-radius: 5px;">
        
        <label>Wybierz Podmiot (Firmę) *</label>
        
        <select formControlName="podmiotId">
          <option [ngValue]="null" disabled>Wybierz z listy...</option>
          
          @for (podmiot of listaPodmiotow(); track podmiot.id) {
            <option [ngValue]="podmiot.id">{{ podmiot.nazwa }}</option>
          }
        </select>
        
        @if (listaPodmiotow().length === 0) {
           <div style="color: red; font-size: 0.8em; margin-top: 5px;">
             Brak podmiotów do wyboru. Dodaj je w zakładce "Podmioty".
           </div>
        }
      </div>
    }

  </form>
</div>